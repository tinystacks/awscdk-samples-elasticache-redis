"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.S3 = void 0;
const constructs_1 = require("constructs");
const s3Deployment = __importStar(require("aws-cdk-lib/aws-s3-deployment"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
class S3 extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const { existingBucketArn, bucketProps } = props;
        this.id = id;
        this.bucketProps = bucketProps;
        if (existingBucketArn !== undefined) {
            this.bucket = s3.Bucket.fromBucketArn(this, `${id}-bucket`, existingBucketArn);
        }
        else {
            this.bucket = this.createBucket();
        }
    }
    createBucket() {
        return new s3.Bucket(this, `${this.id}-bucket`, this.bucketProps);
    }
    uploadSource(source, bucketKeyPrefix) {
        new s3Deployment.BucketDeployment(this, `${this.id}-fileUpload`, {
            sources: source,
            prune: false,
            destinationBucket: this.bucket,
            destinationKeyPrefix: bucketKeyPrefix
        });
    }
    get bucketArn() {
        return this.bucket.bucketArn;
    }
    get bucketName() {
        return this.bucket.bucketName;
    }
}
exports.S3 = S3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29uc3RydWN0cy9jb21wdXRlL3MzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQXVDO0FBQ3ZDLDRFQUE4RDtBQUM5RCx1REFBeUM7QUFRekMsTUFBYSxFQUFHLFNBQVEsc0JBQVM7SUFLL0IsWUFBYSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFjO1FBQ3ZELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsTUFBTSxFQUNKLGlCQUFpQixFQUNqQixXQUFXLEVBQ1osR0FBRyxLQUFLLENBQUM7UUFDVixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBRS9CLElBQUksaUJBQWlCLEtBQUssU0FBUyxFQUFFO1lBQ25DLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztTQUNoRjthQUFNO1lBQ0wsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDbkM7SUFDSCxDQUFDO0lBRU8sWUFBWTtRQUNsQixPQUFPLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFTSxZQUFZLENBQUUsTUFBOEIsRUFBRSxlQUF1QjtRQUMxRSxJQUFJLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxhQUFhLEVBQUU7WUFDL0QsT0FBTyxFQUFFLE1BQU07WUFDZixLQUFLLEVBQUUsS0FBSztZQUNaLGlCQUFpQixFQUFFLElBQUksQ0FBQyxNQUFNO1lBQzlCLG9CQUFvQixFQUFFLGVBQWU7U0FDdEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELElBQVcsU0FBUztRQUNsQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO0lBQy9CLENBQUM7SUFFRCxJQUFXLFVBQVU7UUFDbkIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUNoQyxDQUFDO0NBQ0Y7QUExQ0QsZ0JBMENDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgKiBhcyBzM0RlcGxveW1lbnQgZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzLWRlcGxveW1lbnQnO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzJztcbmltcG9ydCB7IEJ1Y2tldFByb3BzIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzJztcblxuaW50ZXJmYWNlIFMzUHJvcHMge1xuICBidWNrZXRQcm9wcz86IEJ1Y2tldFByb3BzXG4gIGV4aXN0aW5nQnVja2V0QXJuPzogc3RyaW5nXG59XG5cbmV4cG9ydCBjbGFzcyBTMyBleHRlbmRzIENvbnN0cnVjdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgYnVja2V0OiBzMy5JQnVja2V0O1xuICBwcml2YXRlIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgYnVja2V0UHJvcHM6IEJ1Y2tldFByb3BzIHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yIChzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogUzNQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICBjb25zdCB7XG4gICAgICBleGlzdGluZ0J1Y2tldEFybixcbiAgICAgIGJ1Y2tldFByb3BzXG4gICAgfSA9IHByb3BzO1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmJ1Y2tldFByb3BzID0gYnVja2V0UHJvcHM7XG5cbiAgICBpZiAoZXhpc3RpbmdCdWNrZXRBcm4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5idWNrZXQgPSBzMy5CdWNrZXQuZnJvbUJ1Y2tldEFybih0aGlzLCBgJHtpZH0tYnVja2V0YCwgZXhpc3RpbmdCdWNrZXRBcm4pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJ1Y2tldCA9IHRoaXMuY3JlYXRlQnVja2V0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVCdWNrZXQgKCkge1xuICAgIHJldHVybiBuZXcgczMuQnVja2V0KHRoaXMsIGAke3RoaXMuaWR9LWJ1Y2tldGAsIHRoaXMuYnVja2V0UHJvcHMpO1xuICB9XG5cbiAgcHVibGljIHVwbG9hZFNvdXJjZSAoc291cmNlOiBbczNEZXBsb3ltZW50LklTb3VyY2VdLCBidWNrZXRLZXlQcmVmaXg6IHN0cmluZykge1xuICAgIG5ldyBzM0RlcGxveW1lbnQuQnVja2V0RGVwbG95bWVudCh0aGlzLCBgJHt0aGlzLmlkfS1maWxlVXBsb2FkYCwge1xuICAgICAgc291cmNlczogc291cmNlLFxuICAgICAgcHJ1bmU6IGZhbHNlLFxuICAgICAgZGVzdGluYXRpb25CdWNrZXQ6IHRoaXMuYnVja2V0LFxuICAgICAgZGVzdGluYXRpb25LZXlQcmVmaXg6IGJ1Y2tldEtleVByZWZpeFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGdldCBidWNrZXRBcm4gKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuYnVja2V0LmJ1Y2tldEFybjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYnVja2V0TmFtZSAoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5idWNrZXQuYnVja2V0TmFtZTtcbiAgfVxufSJdfQ==